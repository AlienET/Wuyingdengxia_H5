<!DOCTYPE html>
<html lang="en">
 <head> 
  <meta charset="UTF-8" /> 
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <link rel="stylesheet" type="text/css" href="css/style.css">
  <title>文章详情</title> 
</head>
<body>
	<div id="app">
		<div class="comment_list">
			<div class="item">
				<a href="javascript:;" style="margin-top: 0.4em;">
					<img src="images/black.jpg">
				</a>
				<div class="item_xx" style="border-bottom: 0;">
					<div style="overflow: hidden;">
						<span class="item_name">{{username}}</span><br>
						<span class="item_time">{{ctime | DateDiff}}</span>
						<button @click='follow' class="author_btn fl-r" style="margin-top: -1em">{{btn_follow?'关注':'已关注'}}</button>
					</div>
					<div class="item_inner">
						{{commentContent}}
					</div>
				</div>
			</div>
		</div>
		<div style="height: 15px;background: #F3F4F8;"></div>
		<div class="comment_list">
			<div class="comment_num">
				全部回复
			</div>
			<div v-show='aboutData.length == 0' style="padding: 1em;color: #B9B9B9;text-align: center;">
				暂无回复...
			</div>
			<div class="item" v-for='(item,index) in aboutData'>
				<a href="javascript:;">
					<img src="images/black.jpg">
				</a>
				<div class="item_xx">
					<div>
						<span class="item_name">{{item.username}}</span>
						<div class="fl-r">
							<img class="report" src="images/icon/jubao.png">
							<img class="likes" src="images/icon/dianzan.png">
							<span class="likes_num">
								{{item.support_num}}
							</span>
						</div>
					</div>
					<div class="item_inner">
						{{item.comContent}}
					</div>
					<div class="mt-sm">
						<span class="item_time">{{item.retimes | DateDiff}} &nbsp; &bull; &nbsp;</span>
						<span class="item_hf">回复</span>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
	<script type="text/javascript" src="js/vue.min.js"></script>
	<!-- <script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script> -->
	<script type="text/javascript" charset="utf-8" src="js/vue-resource.js"></script>
	<!-- <script src="//cdn.bootcss.com/vue-resource/1.0.3/vue-resource.js" type="text/javascript" charset="utf-8"></script> -->
	<!-- <script type="text/javascript" src="js/vue-router.min.js"></script> -->
	<script type="text/javascript" src="js/vue-router.js"></script>
	<script type="text/javascript">
		new Vue({
	     el: '#app',
	     data:{
	     	//接口数据
	      	aboutData:[], //建一个空数组，用来保存调用接口获取的数据
	      	// 评论ID
	      	commentid:'4',
	      	// 是否关注
	      	btn_follow:true
	     },
	     created: function () {
	      this.getRoute();
	      this.getUrlParam();
	     },
	     methods: {
	     	getRoute: function () {
		        var that = this; 
		        that.$http({
		        	method: 'GET',
		         	url: 'http://39.106.2.216/index.php/API/get_recomment?commentid='+this.commentid //这里填写刚刚后台设置的接口
		        }).then(function(response){
		         	 // promise的then成功之后，将response返回的数据data，保存到aboutData数组里
		         	for (var i = response.data.data.length - 1; i >= 0; i--) {
		         		this.aboutData.push(response.data.data[i])
		         	}
		        },function (error) {
		         	console.log(error);
		        })
	      	},
	      	// 获取参数
	      	getUrlParam: function () {
		        var name,value;
		        var str=decodeURI(location.href); //取得整个地址栏
		        var num=str.indexOf("?");
		        str=str.substr(num+1); //取得所有参数   stringvar.substr(start [, length ]
		    
		        var arr=str.split("&"); //各个参数放到数组里
		        for(var i=0;i < arr.length;i++){
		            num=arr[i].indexOf("=");
		            if(num>0){
		                name=arr[i].substring(0,num);
		                value=arr[i].substr(num+1);
		                this[name]=value;
		            }
		        }
		        // this.commentid = value;
		        // console.log(this.commentid)
		    },
		    // 关注
		    follow:function(argument) {
		    	var that = this;
		    	that.$http({
		    		method:'POST',
		    		url:'http://39.106.2.216/index.php/API/post_follow',
		    		data:{
		    			befollid:this.befollid, //被关注id
		    			userid:this.userid //用户id
		    		}
		    	}).then(function(response) {
		    		this.btn_follow = false;
		    		console.log(response)
		    	},function(error) {
		    		console.log(error)
		    	})
		    }
	     }

	   });
		// 自定义过滤器
		Vue.filter('DateDiff',function(input) {
			var dateTimeStamp = Date.parse(input.replace(/-/gi,"/"));
			var minute = 1000 * 60;
			var hour = minute * 60;
			var day = hour * 24;
			var halfamonth = day * 15;
			var month = day * 30;
			var now = new Date().getTime();
			var diffValue = now - dateTimeStamp;
			if(diffValue < 0){return;}
			var monthC =diffValue/month;
			var weekC =diffValue/(7*day);
			var dayC =diffValue/day;
			var hourC =diffValue/hour;
			var minC =diffValue/minute;
			if(monthC>=1){
				result="" + parseInt(monthC) + " 月前";
			}
			else if(weekC>=1){
				result="" + parseInt(weekC) + " 周前";
			}
			else if(dayC>=1){
				result=""+ parseInt(dayC) +" 天前";
			}
			else if(hourC>=1){
				result=""+ parseInt(hourC) +" 小时前";
			}
			else if(minC>=1){
				result=""+ parseInt(minC) +" 分钟前";
			}else
			result="刚刚";
			return result;
		})
	</script>
</body>
</html>